# Google Cloud Storage 上传工具使用示例

## 准备工作

1. 确保已安装 Go 环境
2. 确保已有 Google Cloud 项目和存储桶
3. 设置 Google Cloud 认证：
   - 方法一：设置环境变量 `GOOGLE_APPLICATION_CREDENTIALS` 指向您的服务账号密钥文件
   - 方法二：使用 `--credentials` 参数指定服务账号密钥文件路径

## 编译程序

```bash
go build -o gsupload main.go
```

## 使用示例

### 上传单个文件

```bash
# 基本用法
./gsupload --bucket=your-bucket-name file /path/to/your/file.txt

# 使用自定义凭证文件
./gsupload --bucket=your-bucket-name --credentials=/path/to/credentials.json file /path/to/your/file.txt

# 设置对象过期时间（7天后过期）
./gsupload --bucket=your-bucket-name --expiration=7 file /path/to/your/file.txt

# 设置对象名称前缀
./gsupload --bucket=your-bucket-name --prefix=uploads/ file /path/to/your/file.txt
```

### 上传整个目录

```bash
# 基本用法
./gsupload --bucket=your-bucket-name dir /path/to/your/directory

# 使用自定义凭证文件
./gsupload --bucket=your-bucket-name --credentials=/path/to/credentials.json dir /path/to/your/directory

# 设置对象过期时间（7天后过期）
./gsupload --bucket=your-bucket-name --expiration=7 dir /path/to/your/directory

# 设置对象名称前缀
./gsupload --bucket=your-bucket-name --prefix=uploads/ dir /path/to/your/directory
```

### 列出存储桶中的对象

```bash
# 列出所有对象
./gsupload --bucket=your-bucket-name list

# 列出指定前缀的对象
./gsupload --bucket=your-bucket-name list uploads/
```

### 获取对象的元数据

```bash
./gsupload --bucket=your-bucket-name info uploads/file.txt
```

### 设置对象的过期时间

```bash
# 设置对象在30天后过期
./gsupload --bucket=your-bucket-name expire uploads/file.txt 30
```

### 删除对象

```bash
./gsupload --bucket=your-bucket-name delete uploads/file.txt
```

## 批量操作示例

### 批量上传并设置过期时间

```bash
#!/bin/bash

# 设置变量
BUCKET_NAME="your-bucket-name"
UPLOAD_DIR="/path/to/your/directory"
PREFIX="uploads/$(date +%Y%m%d)/"
EXPIRATION_DAYS=7

# 上传目录
./gsupload --bucket=$BUCKET_NAME --prefix=$PREFIX --expiration=$EXPIRATION_DAYS dir $UPLOAD_DIR

echo "上传完成！所有文件将在 $EXPIRATION_DAYS 天后过期"
```

### 批量删除指定前缀的对象

```bash
#!/bin/bash

# 设置变量
BUCKET_NAME="your-bucket-name"
PREFIX="uploads/old/"

# 列出对象
OBJECTS=$(./gsupload --bucket=$BUCKET_NAME list $PREFIX | grep -oE "$PREFIX[^ ]+")

# 删除对象
for OBJ in $OBJECTS; do
  echo "正在删除: $OBJ"
  ./gsupload --bucket=$BUCKET_NAME delete "$OBJ"
done

echo "删除完成！"